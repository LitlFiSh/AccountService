### 后端接口

1. 登录 `/user/login`

   ```json
   url:"/user/login"
   method:"POST"
   params:"username", "password"
   //username: 用户id，password: 用户密码
   ```

2. 查找用户信息 `/user/info`

   - 携带参数：`id` 用户id

3. 查询所有部门

   ```json
   url:"/department/departments"
   method:"GET"
   ```

4. 申请单操作

   - 新增申请：

     ```json
     url: "/order"
     method: "POST"
     data:
     	//orderApply
     	{
     		applyDepartment   //申请部门
     		applyUser   //申请人
     		fundcode   //采购经费代码
     		total   //采购总金额
             uid   //用户id
     		orderLists   //申请记录列表
     	}
     //orderList
     {
     	no   //序号
     	name   //物资名称
     	type   //品牌型号
     	configuration   //配置或技术参数
     	unit   //单位
     	quantity   //数量
     	budgetUnitPrice   //预算单价
     	budgetTotalPrice   //预算总价
     	reason   //申购原因及旧设备信息
     	newUser   //新设备使用人
     }
     ```
     
- 更新申请
   
     ```json
     url: "/order"
     method: "PUT"
     params:
     	//申请单
     	{
     		applyDepartment   //申请部门
     		applyUser   //申请人
     		fundcode   //采购经费代码
     		total   //采购总金额
             uid   //用户id
     		orderLists   //申请记录列表
     	}
     ```
  
   - 删除申请
   
     ```json
     url: "/order"
     method: "DELETE"
     pathVariable: "id"
     //id：申请单id
     //例：http://localhost:8080/order/1
  //请求删除 id 为 1 的申请单
     ```

   - 查询所有申请
   
     ```json
     url: "/order/orders"
     method: "GET"
     params: "id","page"
     //id：用户id、 page：查询的第 page 页
     //例：http://localhost:8080/order/orders?id=12345678911&page=2
  //查询用户名为 user01 的第二页申请单
     ```

   - 查询一条申请
   
     ```json
     url: "/order"
     method: "GET"
     params: "id"
  //id：申请单编号
     ```

   - 打印（返回 excel 文件）
   
     ```json
     url:"/order/file"
     method:"GET"
     params:"id"
     //id：申请单编号
     ```


   - 下载可行性报告文件

     ```json
     url:"/order/download"
     method:"GET"
     ```

   - 上传签名文件

     ```json
     url:"/order/file"
     method:"POST"
     params:"id", "file"
     //id: 申请单id，file: 图片文件
     ```

   - 下载签名文件

     ```json
     url:"/order/file/download"
     method:"GET"
     params:"id"
     //id: 申请单id
     ```

```javascript
//下载 Excel 文件
this.$axios
        .get("/order/file", {
          params: {
            id: this.orderApply.id,
          },
          responseType: "blob",   //文件下载的 url 需要带上这个参数
          headers: {
            Authorization: this.$store.state.token,
          },
        })
        .then((res) => {
          console.log(res);
          const { data, headers } = res;
          const fileName = headers["content-disposition"].replace(
            /\w+;filename=(.*)/,
            "$1"
          );   //根据返回头的content-disposition字段中的参数决定文件名
    	  //content-type 决定文件类型
          const blob = new Blob([data], { type: headers["content-type"] });
    	  //下载文件方式：在 html 中插入一个不可见的 a 标签，将返回的文件连接到 a 标签上实现下载
          let dom = document.createElement("a");
          let url = window.URL.createObjectURL(blob);
          dom.href = url;
          dom.download = decodeURI(fileName);
          dom.style.display = "none";
          document.body.appendChild(dom);
          dom.click();
          dom.parentNode.removeChild(dom);
          window.URL.revokeObjectURL(url);
        })
        .catch((err) => {
          console.log(err);
        });
```

```vue
//上传签名文件
<el-upload
    class="upload-demo"
    action="http://localhost:8080/order/file"
    :headers="{ Authorization: this.$store.getters.getToken }"
    :data="{ id: this.orderApply.id }"
    drag
>
    <i class="el-icon-upload"></i>
    <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
    <div class="el-upload__tip" slot="tip">
      只能上传 jpg/png 图片，且大小不能超过1MB
    </div>
</el-upload>
```



注：除了登录接口外，其他接口发送请求时需在请求体头部携带字段为`Authorization`的 token 信息

返回值：

```json
{
    success//请求是否成功，取值 true 或 false
    code//错误代码
    msg//错误信息
    data//返回的数据
}
```

错误代码以及对应错误信息列表：

```
0, "失败"
1, "成功"
/*token错误*/
2, "token失效"
3, "token为空"

/*参数错误*/
11, "参数缺失"
12, "参数错误"

/*用户错误*/
21, "用户未登录"
22, "用户账户过期"
23, "账号密码错误"
24, "密码过期"
25, "账号不可用"
26, "账号被锁定"
27, "账号不存在"
28, "账号已存在"
29, "账号下线"

/*业务错误*/
31, "没有权限"
```

### 数据库表设计

#### 账号及权限

##### Account（账户）

| name      | type        | 描述                       |
| --------- | ----------- | -------------------------- |
| id        | char(11)    | 账户ID                     |
| password  | varchar(64) | 账户密码                   |
| is_active | boolean     | 账户是否可用               |
| openid    | varchar(64) | openID（微信登录用）       |
| role_id   | int         | 角色ID（外键，对应角色表） |

##### Role（角色）

| name      | type        | 描述   |
| --------- | ----------- | ------ |
| id        | int         | 角色ID |
| role_name | varchar(32) | 角色名 |

##### userInfo（用户信息）

| name          | type        | 描述                       |
| ------------- | ----------- | -------------------------- |
| id            | char(11)    | 用户ID                     |
| username      | varchar(32) | 用户名                     |
| department_id | char(2)     | 部门ID（外键，对应部门表） |
| account_id    | char(11)    | 账户ID（外键，对应账户表） |

##### Department（部门）

| name      | type        | 描述     |
| --------- | ----------- | -------- |
| id        | char(2)     | 部门ID   |
| dept_name | varchar(32) | 部门名称 |

##### Menu（菜单）

| name | type        | 描述                       |
| ---- | ----------- | -------------------------- |
| id   | int         | 菜单ID                     |
| path | varchar(64) | 菜单路径                   |
| name | varchar(32) | 菜单名称                   |
| pid  | int         | 父菜单ID                   |
| rid  | int         | 角色ID（外键，对应角色表） |

#### 设备采购申请单

##### orderapply（申请单）

| 字段                  | 类型         | 对应类型 | 描述                         |
| --------------------- | ------------ | -------- | ---------------------------- |
| id                    | char(8)      | String   | 申请单编号                   |
| apply_department      | char(2)      | String   | 申请部门                     |
| apply_user            | varchar(32)  | String   | 申请人                       |
| fund_code             | char(6)      | String   | 采购经费代码                 |
| apply_date            | datetime     | Date     | 申请日期                     |
| total                 | double(16,2) | Double   | 采购总金额（总长度12位数字） |
| dept_leader_sign      | tinyint(1)   | boolean  | 部门领导签名状态             |
| dept_leader_sign_date | datetime     | Date     | 部门领导签名日期             |
| inst_leader_sign      | tinyint(1)   | boolean  | 主管院领导签名状态           |
| inst_leader_sign_date | datetime     | Date     | 主管院领导签名日期           |
| status                | tinyint(2)   | Integer  | 申请单状态                   |
| file                  | blob         | byte[]   | 签名文件                     |

##### orderlist（申请记录）

| 字段               | 类型         | 对应类型 | 描述                     |
| ------------------ | ------------ | -------- | ------------------------ |
| id                 | char(10)     | String   | id（申请单id + 序号）    |
| no                 | char(2)      | String   | 序号                     |
| name               | varchar(255) | String   | 物资名称                 |
| type               | varchar(255) | String   | 品牌型号                 |
| configuration      | text         | String   | 配置或技术参数           |
| unit               | char(1)      | String   | 单位                     |
| quantity           | int          | Integer  | 数量                     |
| budget_unit_price  | double(12,2) | Double   | 预算单价                 |
| budget_total_price | double(14,2) | Double   | 预算总价                 |
| reason             | text         | String   | 申购原因及旧设备参数状态 |
| new_user           | varchar(32)  | String   | 新设备使用人             |
| from_id            | char(8)      | String   | 对应申请单id             |
| status             | tinyint(2)   | Integer  | 申请记录状态             |
